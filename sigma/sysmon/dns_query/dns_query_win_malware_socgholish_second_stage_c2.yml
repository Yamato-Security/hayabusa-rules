title: Potential SocGholish Second Stage C2 DNS Query
ruletype: Sigma
author: Dusty Miller
date: 2023/02/23
description: Detects a DNS query initiated from a "wscript" process for domains matching
    a specific pattern that was seen being used by SocGholish for its Command and
    Control traffic
detection:
    SELECTION_1:
        EventID: 22
    SELECTION_2:
        Channel: Microsoft-Windows-Sysmon/Operational
    SELECTION_3:
        Image: '*\wscript.exe'
    SELECTION_4:
        QueryName|re: '[a-f0-9]{4,8}\.(?:[a-z0-9\-]+\.){2}[a-z0-9\-]+'
    condition: (SELECTION_1 and SELECTION_2 and SELECTION_3 and SELECTION_4)
falsepositives:
- Legitimate domain names matching the regex pattern by chance (e.g. domain controllers
    dc01.company.co.uk)
id: 70761fe8-6aa2-4f80-98c1-a57049c08e66
level: high
logsource:
    category: dns_query
    product: windows
references:
- https://www.virustotal.com/gui/file/0e2854753d17b1bb534de8e765d5813c9fb584a745978b3d92bc6ca78e3e7735/relations
- https://www.virustotal.com/gui/file/d5661009c461a8b20e1ad22f48609cc84dd90aee9182e026659dde4d46aaf25e/relations
- https://www.proofpoint.com/us/blog/threat-insight/part-1-socgholish-very-real-threat-very-fake-update
status: experimental
tags:
- attack.command_and_control
- attack.t1219

