title: COLDSTEEL RAT Cleanup Command Execution
ruletype: Sigma
author: Nasreddine Bencherchali (Nextron Systems)
date: 2023/04/30
description: Detects the creation of a "rundll32" process from the ColdSteel persistence
    service to initiate the cleanup command by calling one of its own exports. This
    functionality is not present in "MileStone2017" and some "MileStone2016" samples
detection:
    SELECTION_1:
        EventID: 1
    SELECTION_2:
        Channel: Microsoft-Windows-Sysmon/Operational
    SELECTION_3:
        ParentImage: '*\svchost.exe'
    SELECTION_4:
        ParentCommandLine:
        - '* -k msupdate*'
        - '* -k msupdate2*'
        - '* -k alg*'
    SELECTION_5:
        Image: '*\rundll32.exe'
    SELECTION_6:
        CommandLine:
        - '*UpdateDriverForPlugAndPlayDevicesW*'
        - '*ServiceMain*'
        - '*DiUninstallDevice*'
    condition: (SELECTION_1 and SELECTION_2 and SELECTION_3 and SELECTION_4 and SELECTION_5
        and SELECTION_6)
falsepositives:
- Unlikely
id: 88516f06-ebe0-47ad-858e-ae9fd060ddea
level: critical
logsource:
    category: process_creation
    product: windows
references:
- https://www.ncsc.gov.uk/static-assets/documents/malware-analysis-reports/cold-steel/NCSC-MAR-Cold-Steel.pdf
status: experimental
tags:
- attack.persistence
- attack.defense_evasion

