title: Potential CVE-2022-22954 Exploitation Attempt - VMware Workspace ONE Access Remote Code Execution
id: c673198f-36bd-eaf8-5986-f439d6b8c2a8
related:
    - id: 5660d8db-6e25-411f-b92f-094420168a5d
      type: derived
status: test
description: |
    Detects potential exploitation attempt of CVE-2022-22954, a remote code execution vulnerability in VMware Workspace ONE Access and Identity Manager.
    As reported by Morphisec, part of the attack chain, threat actors used PowerShell commands that executed as a child processes of the legitimate Tomcat "prunsrv.exe" process application.
references:
    - https://blog.morphisec.com/vmware-identity-manager-attack-backdoor
    - https://github.com/DrorDvash/CVE-2022-22954_VMware_PoC
author: '@kostastsale'
date: 2022-04-25
tags:
    - attack.execution
    - attack.initial-access
    - attack.t1059.006
    - attack.t1190
    - cve.2022-22954
    - detection.emerging-threats
    - sysmon
logsource:
    category: process_creation
    product: windows
detection:
    process_creation:
        EventID: 4688
        Channel: Security
    selection_parent:
        ParentProcessName|endswith: \prunsrv.exe
    selection_payload_pwsh:
        NewProcessName|endswith: \powershell.exe
    selection_payload_cmd:
        CommandLine|contains: /c powershell
        NewProcessName|endswith: \cmd.exe
    condition: process_creation and (selection_parent and 1 of selection_payload_*)
falsepositives:
    - Some false positives are possible as part of a custom script implementation from admins executed with cmd.exe as the child process.
level: medium
ruletype: Sigma
