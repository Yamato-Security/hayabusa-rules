title: Potential Kapeka Decrypted Backdoor Indicator
id: db6a3631-9d7f-8ee2-6b13-cee9e0c9222a
related:
    - id: 20228d05-dd68-435d-8b4e-e7e64938880c
      type: derived
status: experimental
description: |
    Detects the presence of a file that is decrypted backdoor binary dropped by the Kapeka Dropper, which disguises itself as a hidden file under a folder named "Microsoft" within "CSIDL_COMMON_APPDATA" or "CSIDL_LOCAL_APPDATA", depending on the process privileges.
    The file, typically 5-6 characters long with a random combination of consonants and vowels followed by a ".wll" extension to pose as a legitimate file to evade detection.
references:
    - https://labs.withsecure.com/publications/kapeka
    - https://app.any.run/tasks/1efb3ed4-cc0f-4690-a0ed-24516809bc72/
author: Swachchhanda Shrawan Poudel, Nasreddine Bencherchali (Nextron Systems)
date: 2024-07-03
tags:
    - attack.defense-evasion
    - detection.emerging-threats
    - sysmon
logsource:
    category: file_event
    product: windows
detection:
    file_event:
        EventID: 11
        Channel: Microsoft-Windows-Sysmon/Operational
    selection_generic:
        TargetFilename|contains:
            - :\ProgramData\
            - \AppData\Local\
        TargetFilename|re: \\[a-zA-Z]{5,6}\.wll
    selection_specific:
        TargetFilename|endswith:
            - \win32log.exe
            - \crdss.exe
    condition: file_event and (1 of selection_*)
falsepositives:
    - Unknown
level: high
ruletype: Sigma
