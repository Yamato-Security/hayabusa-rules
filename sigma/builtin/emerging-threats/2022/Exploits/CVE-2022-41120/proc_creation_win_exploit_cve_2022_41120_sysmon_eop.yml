title: Suspicious Sysmon as Execution Parent
id: 8093c636-02d2-54cd-0170-9c7037dadfda
related:
    - id: 6d1058a4-407e-4f3a-a144-1968c11dc5c3
      type: derived
status: test
description: Detects suspicious process executions in which Sysmon itself is the parent of a process, which could be a sign of exploitation (e.g. CVE-2022-41120)
references:
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41120
    - https://twitter.com/filip_dragovic/status/1590052248260055041
    - https://twitter.com/filip_dragovic/status/1590104354727436290
author: Florian Roth (Nextron Systems), Tim Shelton (fp werfault)
date: 2022-11-10
modified: 2025-07-04
tags:
    - attack.privilege-escalation
    - attack.t1068
    - cve.2022-41120
    - detection.emerging-threats
logsource:
    product: windows
    category: process_creation
detection:
    process_creation:
        EventID: 4688
        Channel: Security
    selection:
        ParentProcessName|endswith:
            - \Sysmon.exe
            - \Sysmon64.exe
    filter_main_temp_sysmon:
        # C:\Users\ADMINI~1\AppData\Local\Temp\2\Sysmon.exe
        NewProcessName|startswith: C:\Users\
        NewProcessName|contains: \AppData\Local\Temp\
        NewProcessName|endswith:
            - \Sysmon.exe
            - \Sysmon64.exe
    filter_main_generic:
        NewProcessName|contains:
            - :\Windows\Sysmon.exe
            - :\Windows\Sysmon64.exe
            - :\Windows\System32\conhost.exe
            - :\Windows\System32\WerFault.exe   # When Sysmon crashes
            - :\Windows\System32\WerFaultSecure.exe   # When Sysmon crashes
            - :\Windows\System32\wevtutil.exe
            - :\Windows\SysWOW64\wevtutil.exe
    filter_main_null:
        NewProcessName: null
    condition: process_creation and (selection and not 1 of filter_main_*)
falsepositives:
    - Unknown
level: high
ruletype: Sigma
