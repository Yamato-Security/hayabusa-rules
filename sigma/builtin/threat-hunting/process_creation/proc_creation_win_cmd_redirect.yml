title: CMD Shell Output Redirect
id: 168763f9-a5fa-29af-e778-ed5054fe3044
status: test
description: |
    Detects the use of the redirection character ">" to redirect information on the command line.
    This technique is sometimes used by malicious actors in order to redirect the output of reconnaissance commands such as "hostname" and "dir" to files for future exfiltration.
references:
    - https://ss64.com/nt/syntax-redirection.html
author: frack113
date: 2022/01/22
modified: 2024/03/19
tags:
    - attack.discovery
    - attack.t1082
    - detection.threat_hunting
    - sysmon
logsource:
    category: process_creation
    product: windows
detection:
    process_creation:
        EventID: 4688
        Channel: Security
    selection_cmd:
        - OriginalFileName: Cmd.Exe
        - NewProcessName|endswith: \cmd.exe
    selection_cli:
        CommandLine|contains: '>'
    filter_optional_idm_extension:
        CommandLine|contains:
            - C:\Program Files (x86)\Internet Download Manager\IDMMsgHost.exe
            - chrome-extension://
            - \\.\pipe\chrome.nativeMessaging
    condition: process_creation and (all of selection_* and not 1 of filter_optional_*)
falsepositives:
    - Internet Download Manager extensions use named pipes and redirection via CLI. Filter it out if you use it in your environment
level: low
ruletype: Sigma
