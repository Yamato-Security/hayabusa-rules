title: Potential KamiKakaBot Activity - Winlogon Shell Persistence
id: cf1430ec-12d6-951e-d5df-4dbbc3a085d9
related:
    - id: c9b86500-1ec2-4de6-9120-d744c8fb5caf
      type: derived
status: experimental
description: |
    Detects changes to the "Winlogon" registry key where a process will set the value of the "Shell" to a value that was observed being used by KamiKakaBot samples in order to achieve persistence.
references:
    - https://www.nextron-systems.com/2024/03/22/unveiling-kamikakabot-malware-analysis/
author: Nasreddine Bencherchali (Nextron Systems), X__Junior
date: 2024-03-22
tags:
    - attack.persistence
    - attack.t1547.001
    - detection.emerging-threats
    - sysmon
logsource:
    category: registry_set
    product: windows
detection:
    registry_set:
        EventID: 13
        Channel: Microsoft-Windows-Sysmon/Operational
    selection:
        TargetObject|endswith: \Microsoft\Windows NT\CurrentVersion\Winlogon\Shell
        Details|contains|all:
            - -nop -w h
            - $env
            - explorer.exe
            - Start-Process
    condition: registry_set and selection
falsepositives:
    - Unlikely
level: high
ruletype: Sigma
