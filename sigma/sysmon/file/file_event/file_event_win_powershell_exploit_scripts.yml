title: Malicious PowerShell Commandlet Names
ruletype: Sigma
author: Markus Neis, Nasreddine Bencherchali
date: 2018/04/07
description: Detects the creation of known powershell scripts for exploitation
detection:
    SELECTION_1:
        EventID: 11
    SELECTION_2:
        Channel: Microsoft-Windows-Sysmon/Operational
    SELECTION_3:
        TargetFilename:
        - '*\Invoke-DllInjection.ps1'
        - '*\Invoke-WmiCommand.ps1'
        - '*\Get-GPPPassword.ps1'
        - '*\Get-Keystrokes.ps1'
        - '*\Get-VaultCredential.ps1'
        - '*\Invoke-CredentialInjection.ps1'
        - '*\Invoke-Mimikatz.ps1'
        - '*\Invoke-NinjaCopy.ps1'
        - '*\Invoke-TokenManipulation.ps1'
        - '*\Out-Minidump.ps1'
        - '*\VolumeShadowCopyTools.ps1'
        - '*\Invoke-ReflectivePEInjection.ps1'
        - '*\Get-TimedScreenshot.ps1'
        - '*\Invoke-UserHunter.ps1'
        - '*\Find-GPOLocation.ps1'
        - '*\Invoke-ACLScanner.ps1'
        - '*\Invoke-DowngradeAccount.ps1'
        - '*\Get-ServiceUnquoted.ps1'
        - '*\Get-ServiceFilePermission.ps1'
        - '*\Get-ServicePermission.ps1'
        - '*\Invoke-ServiceAbuse.ps1'
        - '*\Install-ServiceBinary.ps1'
        - '*\Get-RegAutoLogon.ps1'
        - '*\Get-VulnAutoRun.ps1'
        - '*\Get-VulnSchTask.ps1'
        - '*\Get-UnattendedInstallFile.ps1'
        - '*\Get-WebConfig.ps1'
        - '*\Get-ApplicationHost.ps1'
        - '*\Get-RegAlwaysInstallElevated.ps1'
        - '*\Get-Unconstrained.ps1'
        - '*\Add-RegBackdoor.ps1'
        - '*\Add-ScrnSaveBackdoor.ps1'
        - '*\Gupt-Backdoor.ps1'
        - '*\Invoke-ADSBackdoor.ps1'
        - '*\Enabled-DuplicateToken.ps1'
        - '*\Invoke-PsUaCme.ps1'
        - '*\Remove-Update.ps1'
        - '*\Check-VM.ps1'
        - '*\Get-LSASecret.ps1'
        - '*\Get-PassHashes.ps1'
        - '*\Show-TargetScreen.ps1'
        - '*\Port-Scan.ps1'
        - '*\Invoke-PoshRatHttp.ps1'
        - '*\Invoke-PowerShellTCP.ps1'
        - '*\Invoke-PowerShellWMI.ps1'
        - '*\Add-Exfiltration.ps1'
        - '*\Add-Persistence.ps1'
        - '*\Do-Exfiltration.ps1'
        - '*\Start-CaptureServer.ps1'
        - '*\Invoke-ShellCode.ps1'
        - '*\Get-ChromeDump.ps1'
        - '*\Get-ClipboardContents.ps1'
        - '*\Get-FoxDump.ps1'
        - '*\Get-IndexedItem.ps1'
        - '*\Get-Screenshot.ps1'
        - '*\Invoke-Inveigh.ps1'
        - '*\Invoke-NetRipper.ps1'
        - '*\Invoke-EgressCheck.ps1'
        - '*\Invoke-PostExfil.ps1'
        - '*\Invoke-PSInject.ps1'
        - '*\Invoke-RunAs.ps1'
        - '*\MailRaider.ps1'
        - '*\New-HoneyHash.ps1'
        - '*\Set-MacAttribute.ps1'
        - '*\Invoke-DCSync.ps1'
        - '*\Invoke-PowerDump.ps1'
        - '*\Exploit-Jboss.ps1'
        - '*\Invoke-ThunderStruck.ps1'
        - '*\Invoke-VoiceTroll.ps1'
        - '*\Set-Wallpaper.ps1'
        - '*\Invoke-InveighRelay.ps1'
        - '*\Invoke-PsExec.ps1'
        - '*\Invoke-SSHCommand.ps1'
        - '*\Get-SecurityPackages.ps1'
        - '*\Install-SSP.ps1'
        - '*\Invoke-BackdoorLNK.ps1'
        - '*\PowerBreach.ps1'
        - '*\Get-SiteListPassword.ps1'
        - '*\Get-System.ps1'
        - '*\Invoke-BypassUAC.ps1'
        - '*\Invoke-Tater.ps1'
        - '*\Invoke-WScriptBypassUAC.ps1'
        - '*\PowerUp.ps1'
        - '*\PowerView.ps1'
        - '*\Get-RickAstley.ps1'
        - '*\Find-Fruit.ps1'
        - '*\HTTP-Login.ps1'
        - '*\Find-TrustedDocuments.ps1'
        - '*\Invoke-Paranoia.ps1'
        - '*\Invoke-WinEnum.ps1'
        - '*\Invoke-ARPScan.ps1'
        - '*\Invoke-PortScan.ps1'
        - '*\Invoke-ReverseDNSLookup.ps1'
        - '*\Invoke-SMBScanner.ps1'
        - '*\Invoke-Mimikittenz.ps1'
        - '*\PowerUpSQL.ps1'
        - '*\Get-ComputerDetail.ps1'
        - '*\Find-AVSignature.ps1'
        - '*\Get-GPPAutologon.ps1'
        - '*\Get-MicrophoneAudio.ps1'
        - '*\Invoke-EventViewer.ps1'
        - '*\WSUSpendu.ps1'
        - '*\Invoke-PowerThIEf.ps1'
        - '*\WinPwn.ps1'
        - '*\Offline_Winpwn.ps1'
        - '*\PowerSharpPack.ps1'
        - '*\Invoke-BadPotato.ps1'
        - '*\Invoke-BetterSafetyKatz.ps1'
        - '*\Invoke-Carbuncle.ps1'
        - '*\Invoke-Certify.ps1'
        - '*\Invoke-DAFT.ps1'
        - '*\Invoke-DinvokeKatz.ps1'
        - '*\Invoke-Eyewitness.ps1'
        - '*\Invoke-FakeLogonScreen.ps1'
        - '*\Invoke-Farmer.ps1'
        - '*\Invoke-Get-RBCD-Threaded.ps1'
        - '*\Invoke-Gopher.ps1'
        - '*\Invoke-Grouper2.ps1'
        - '*\Invoke-HandleKatz.ps1'
        - '*\Invoke-Internalmonologue.ps1'
        - '*\Invoke-KrbRelayUp.ps1'
        - '*\Invoke-LdapSignCheck.ps1'
        - '*\Invoke-Lockless.ps1'
        - '*\Invoke-MITM6.ps1'
        - '*\Invoke-NanoDump.ps1'
        - '*\Invoke-OxidResolver.ps1'
        - '*\Invoke-P0wnedshell.ps1'
        - '*\Invoke-P0wnedshellx86.ps1'
        - '*\Invoke-PPLDump.ps1'
        - '*\Invoke-Rubeus.ps1'
        - '*\Invoke-SCShell.ps1'
        - '*\Invoke-SafetyKatz.ps1'
        - '*\Invoke-SauronEye.ps1'
        - '*\Invoke-Seatbelt.ps1'
        - '*\Invoke-SharPersist.ps1'
        - '*\Invoke-SharpAllowedToAct.ps1'
        - '*\Invoke-SharpBlock.ps1'
        - '*\Invoke-SharpBypassUAC.ps1'
        - '*\Invoke-SharpChromium.ps1'
        - '*\Invoke-SharpClipboard.ps1'
        - '*\Invoke-SharpCloud.ps1'
        - '*\Invoke-SharpDPAPI.ps1'
        - '*\Invoke-SharpDump.ps1'
        - '*\Invoke-SharpGPO-RemoteAccessPolicies.ps1'
        - '*\Invoke-SharpGPOAbuse.ps1'
        - '*\Invoke-SharpHandler.ps1'
        - '*\Invoke-SharpHide.ps1'
        - '*\Invoke-SharpHound4.ps1'
        - '*\Invoke-SharpImpersonation.ps1'
        - '*\Invoke-SharpImpersonationNoSpace.ps1'
        - '*\Invoke-SharpKatz.ps1'
        - '*\Invoke-SharpLdapRelayScan.ps1'
        - '*\Invoke-SharpLoginPrompt.ps1'
        - '*\Invoke-SharpMove.ps1'
        - '*\Invoke-SharpPrintNightmare.ps1'
        - '*\Invoke-SharpPrinter.ps1'
        - '*\Invoke-SharpRDP.ps1'
        - '*\Invoke-SharpSSDP.ps1'
        - '*\Invoke-SharpSecDump.ps1'
        - '*\Invoke-SharpSniper.ps1'
        - '*\Invoke-SharpSploit.ps1'
        - '*\Invoke-SharpSpray.ps1'
        - '*\Invoke-SharpStay.ps1'
        - '*\Invoke-SharpUp.ps1'
        - '*\Invoke-SharpWatson.ps1'
        - '*\Invoke-Sharphound2.ps1'
        - '*\Invoke-Sharphound3.ps1'
        - '*\Invoke-Sharplocker.ps1'
        - '*\Invoke-Sharpshares.ps1'
        - '*\Invoke-Sharpsploit_nomimi.ps1'
        - '*\Invoke-Sharpview.ps1'
        - '*\Invoke-Sharpweb.ps1'
        - '*\Invoke-Snaffler.ps1'
        - '*\Invoke-Spoolsample.ps1'
        - '*\Invoke-StandIn.ps1'
        - '*\Invoke-StickyNotesExtract.ps1'
        - '*\Invoke-Thunderfox.ps1'
        - '*\Invoke-Tokenvator.ps1'
        - '*\Invoke-UrbanBishop.ps1'
        - '*\Invoke-Whisker.ps1'
        - '*\Invoke-WireTap.ps1'
        - '*\Invoke-winPEAS.ps1'
        - '*\Invoke-Zerologon.ps1'
        - '*\Get-USBKeystrokes.ps1'
        - '*\Start-WebcamRecorder.ps1'
        - '*\PSAsyncShell.ps1'
    condition: (SELECTION_1 and SELECTION_2 and SELECTION_3)
falsepositives:
- Unknown
id: f331aa1f-8c53-4fc3-b083-cc159bc971cb
level: high
logsource:
    category: file_event
    product: windows
modified: 2022/10/04
references:
- https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml
- https://github.com/PowerShellMafia/PowerSploit
- https://github.com/NetSPI/PowerUpSQL
- https://github.com/CsEnox/EventViewer-UACBypass
- https://github.com/AlsidOfficial/WSUSpendu/
- https://github.com/nettitude/Invoke-PowerThIEf
- https://github.com/S3cur3Th1sSh1t/WinPwn
- https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries
- https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1
- https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1
status: test
tags:
- attack.execution
- attack.t1059.001

