title: Potential Exploitation of CVE-2024-37085 - Suspicious Creation Of ESX Admins Group
id: 15644804-cc2a-8565-e214-eefd44105fed
related:
    - id: c408acfe-2870-41df-8d2f-9f4daa4555ed
      type: derived
status: experimental
description: |
    Detects execution of the "net.exe" command in order to add a group named "ESX Admins".
    This could indicates a potential exploitation attempt of CVE-2024-37085, which allows an attacker to elevate their privileges to full administrative access on an domain-joined ESXi hypervisor.
    VMware ESXi hypervisors joined to an Active Directory domain consider any member of a domain group named "ESX Admins" to have full administrative access by default.
references:
    - https://www.microsoft.com/en-us/security/blog/2024/07/29/ransomware-operators-exploit-esxi-hypervisor-vulnerability-for-mass-encryption/
author: frack113
date: 2024/07/29
tags:
    - attack.execution
    - cve.2024.37085
    - detection.emerging_threats
    - sysmon
logsource:
    category: process_creation
    product: windows
detection:
    process_creation:
        EventID: 4688
        Channel: Security
    selection_net_img:
        - NewProcessName|endswith:
              - \net.exe
              - \net1.exe
        - OriginalFileName:
              - net.exe
              - net1.exe
    selection_net_cmd:
        CommandLine|contains|all:
            - /add
            - /domain
            - ESX Admins
            - group
    selection_powershell_img:
        - NewProcessName|endswith:
              - \PowerShell.exe
              - \pwsh.exe
        - OriginalFileName:
              - PowerShell.exe
              - pwsh.dll
    selection_powershell_cli:
        CommandLine|contains|all:
            - New-ADGroup
            - ESX Admins
    condition: process_creation and (all of selection_net_* or all of selection_powershell_*)
falsepositives:
    - Unknown
level: high
ruletype: Sigma
