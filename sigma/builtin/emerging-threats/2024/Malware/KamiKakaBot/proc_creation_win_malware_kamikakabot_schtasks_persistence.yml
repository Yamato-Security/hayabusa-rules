title: Potential KamiKakaBot Activity - Shutdown Schedule Task Creation
id: 1fc29c50-4d7c-1839-46c5-1d5346ece8fa
related:
    - id: fe9e8ba9-4419-41e6-a574-bd9f7b3af961
      type: derived
status: test
description: |
    Detects the creation of a schedule task that runs weekly and execute the "shutdown /l /f" command.
    This behavior was observed being used by KamiKakaBot samples in order to achieve persistence on a system.
references:
    - https://www.nextron-systems.com/2024/03/22/unveiling-kamikakabot-malware-analysis/
    - https://tria.ge/240123-rapteaahhr/behavioral1
author: Nasreddine Bencherchali (Nextron Systems), X__Junior (Nextron Systems)
date: 2024-03-22
tags:
    - attack.persistence
    - detection.emerging-threats
logsource:
    category: process_creation
    product: windows
detection:
    process_creation:
        EventID: 4688
        Channel: Security
    selection:
        CommandLine|contains|all:
            - ' /create '
            - shutdown /l /f
            - WEEKLY
        NewProcessName|endswith: \schtasks.exe
    filter_main_system_user:
        SubjectUserName|contains: # covers many language settings
            - AUTHORI
            - AUTORI
    condition: process_creation and (selection and not 1 of filter_main_*)
falsepositives:
    - Unknown
level: medium
ruletype: Sigma
