title: Windows Kernel and 3rd-Party Drivers Exploits Token Stealing
ruletype: Sigma
author: Teymur Kheirkhabarov (source), Daniil Yugoslavskiy (rule)
date: 2019/06/03
description: Detection of child processes spawned with SYSTEM privileges by parents
    with non-SYSTEM privileges and Medium integrity level
detection:
    SELECTION_1:
        EventID: 4688
    SELECTION_2:
        Channel: Security
    SELECTION_3:
        ParentIntegrityLevel: Medium
    SELECTION_4:
        IntegrityLevel: System
    SELECTION_5:
        User: NT AUTHORITY\SYSTEM
    condition: (SELECTION_1 and SELECTION_2 and SELECTION_3 and SELECTION_4 and SELECTION_5)
falsepositives:
- Unknown
id: 8065b1b4-1778-4427-877f-6bf948b26d38
level: high
logsource:
    category: process_creation
    definition: Works only if  Enrich Sysmon events with additional information about
        process in ParentIntegrityLevel check enrichment section
    product: windows
references:
- https://www.slideshare.net/heirhabarov/hunting-for-privilege-escalation-in-windows-environment
status: unsupported
tags:
- attack.privilege_escalation
- attack.t1068

